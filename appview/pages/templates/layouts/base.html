{{ define "layouts/base" }}
    <!doctype html>
    <html lang="en" class="dark:bg-gray-900">
        <head>
            <meta charset="UTF-8" />
            <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
            <meta name="description" content="tightly-knit social coding"/>
            <meta name="keywords" content="git hosting, social coding, version control, pull requests, CI/CD, code collaboration, open source, decentralized"/>
            <meta name="htmx-config" content='{"includeIndicatorStyles": false}'>
            <meta name="author" content="Tangled"/>

            <!-- Canonical URL -->
            <link rel="canonical" href="{{ block "canonical" . }}https://tangled.org{{ .Request.URL.Path }}{{ end }}" />

            <script defer src="/static/htmx.min.js"></script>
            <script defer src="/static/htmx-ext-ws.min.js"></script>

            <!-- preconnect to image cdn -->
            <link rel="preconnect" href="https://avatar.tangled.sh" />
            <link rel="preconnect" href="https://camo.tangled.sh" />

            <!-- RSS Feed Discovery -->
            {{ block "rss" . }}{{ end }}

            <!-- pwa manifest -->
            <link rel="manifest" href="/pwa-manifest.json" />

            <!-- preload main font -->
            <link rel="preload" href="/static/fonts/InterVariable.woff2" as="font" type="font/woff2" crossorigin />

            <link rel="stylesheet" href="/static/tw.css?{{ cssContentHash }}" type="text/css" />
            <title>{{ block "title" . }}{{ end }}</title>

            <!-- Structured Data -->
            {{ block "structuredData" . }}
            <script type="application/ld+json">
            {
              "@context": "https://schema.org",
              "@type": "Organization",
              "name": "Tangled",
              "url": "https://tangled.org",
              "logo": "https://tangled.org/favicon.svg",
              "description": "tightly-knit social coding",
              "sameAs": []
            }
            </script>
            {{ end }}

            {{ block "extrameta" . }}{{ end }}
        </head>
        <body class="min-h-screen flex flex-col gap-4 bg-slate-100 dark:bg-gray-900 dark:text-white transition-colors duration-200">
          {{ block "topbarLayout" . }}
            <header class="w-full col-span-full md:col-span-1 md:col-start-2" style="z-index: 20;">

               {{ if .LoggedInUser }}
                <div id="upgrade-banner"
                     hx-get="/upgradeBanner"
                     hx-trigger="load"
                     hx-swap="innerHTML">
                </div>
              {{ end }}
              {{ template "layouts/fragments/topbar" . }}
            </header>
          {{ end }}

          {{ block "mainLayout" . }}
            <div class="flex-grow">
              <div class="max-w-screen-lg mx-auto flex flex-col gap-4">
                {{ block "contentLayout" . }}
                <main>
                  {{ block "content" . }}{{ end }}
                </main>
                {{ end }}

                {{ block "contentAfterLayout" . }}
                <main>
                  {{ block "contentAfter" . }}{{ end }}
                </main>
                {{ end }}
              </div>
            </div>
          {{ end }}

          {{ block "footerLayout" . }}
            <footer class="mt-12">
              {{ template "layouts/fragments/footer" . }}
            </footer>
          {{ end }}
        </body>
    </html>
{{ end }}
