{{ define "title" }}{{ .Tab }} settings &middot; {{ .RepoInfo.FullName }}{{ end }}

{{ define "repoContent" }}
  <section class="w-full grid grid-cols-1 md:grid-cols-4 gap-2">
    <div class="col-span-1">
      {{ template "repo/settings/fragments/sidebar" . }}
    </div>
    <div class="col-span-1 md:col-span-3 flex flex-col gap-6 p-2">
      {{ template "branchSettings" . }}
      {{ template "defaultLabelSettings" . }}
      {{ template "customLabelSettings" . }}
      {{ template "deleteRepo" . }}
      <div id="operation-error" class="text-red-500 dark:text-red-400"></div>
    </div>
  </section>
{{ end }}

{{ define "branchSettings" }}
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-center">
    <div class="col-span-1 md:col-span-2">
      <h2 class="text-sm pb-2 uppercase font-bold">Default Branch</h2>
      <p class="text-gray-500 dark:text-gray-400">
        The default branch is considered the “base” branch in your repository,
        against which all pull requests and code commits are automatically made,
        unless you specify a different branch.
      </p>
    </div>
    <form hx-put="/{{ $.RepoInfo.FullName }}/settings/branches/default" hx-swap="none" class="col-span-1 md:col-span-1 md:justify-self-end group flex gap-2 items-stretch">
      <select id="branch" name="branch" required class="p-1 max-w-64 border border-gray-200 bg-white dark:bg-gray-800 dark:text-white dark:border-gray-700">
        <option value="" disabled selected >
          Choose a default branch
        </option>
        {{ range .Branches }}
          <option value="{{ .Name }}" class="py-1" {{ if .IsDefault }}selected{{ end }} >
            {{ .Name }}
          </option>
        {{ end }}
      </select>
      <button class="btn flex gap-2 items-center" type="submit">
        {{ i "check" "size-4" }}
        {{ i "loader-circle" "w-4 h-4 animate-spin hidden group-[.htmx-request]:inline" }}
      </button>
    </form>
  </div>
{{ end }}

{{ define "defaultLabelSettings" }}
  <div class="flex flex-col gap-2">
    <h2 class="text-sm pb-2 uppercase font-bold">Default Labels</h2>
    <p class="text-gray-500 dark:text-gray-400">
      Manage your issues and pulls by creating labels to categorize them. Only
      repository owners may configure labels. You may choose to subscribe to
      default labels, or create entirely custom labels.
    </p>
    <div class="flex flex-col rounded border border-gray-200 dark:border-gray-700 divide-y divide-gray-200 dark:divide-gray-700 w-full">
      {{ range .DefaultLabels }}
        <div id="label-{{.Id}}" class="flex items-center justify-between p-2 pl-4">
          {{ template "repo/settings/fragments/labelListing" (list $ .) }}
          {{ $action := "subscribe" }}
          {{ $icon := "plus" }}
          {{ if mapContains $.SubscribedLabels .AtUri.String }}
            {{ $action = "unsubscribe" }}
            {{ $icon = "minus" }}
          {{ end }}
          <button
            class="btn gap-2 group"
            title="{{$action}} from label"
            {{ if not $.RepoInfo.Roles.IsOwner }}disabled{{ end }}
            hx-post="/{{ $.RepoInfo.FullName }}/settings/label/{{$action}}"
            hx-swap="none"
            hx-vals='{"label": "{{ .AtUri.String }}"}'>
            {{ i $icon "size-4" }}
            <span class="hidden md:inline">{{$action}}</span>
            {{ i "loader-circle" "w-4 h-4 animate-spin hidden group-[.htmx-request]:inline" }}
          </button>
        </div>
      {{ else }}
      <div class="flex items-center justify-center p-2 text-gray-500">
        no labels added yet
      </div>
      {{ end }}
    </div>
    <div id="default-label-operation" class="error"></div>
  </div>
{{ end }}

{{ define "customLabelSettings" }}
  <div class="flex flex-col gap-2">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-center">
      <div class="col-span-1 md:col-span-2">
        <h2 class="text-sm pb-2 uppercase font-bold">Custom Labels</h2>
      </div>
      <div class="col-span-1 md:col-span-1 md:justify-self-end">
        <button
          title="Add custom label"
          class="btn flex items-center gap-2"
          popovertarget="add-labeldef-modal"
          {{ if not .RepoInfo.Roles.IsOwner }}disabled{{ end }}
          popovertargetaction="toggle">
          {{ i "plus" "size-4" }}
          add label
        </button>
        <div
          id="add-labeldef-modal"
          popover
          class="bg-white w-full sm:w-[30rem] dark:bg-gray-800 p-6 max-h-dvh overflow-y-auto rounded border border-gray-200 dark:border-gray-700 drop-shadow dark:text-white backdrop:bg-gray-400/50 dark:backdrop:bg-gray-800/50">
          {{ template "repo/settings/fragments/addLabelDefModal" . }}
        </div>
      </div>
    </div>
    <div class="flex flex-col rounded border border-gray-200 dark:border-gray-700 divide-y divide-gray-200 dark:divide-gray-700 w-full">
      {{ range .Labels }}
        <div id="label-{{.Id}}" class="flex items-center justify-between p-2 pl-4">
          {{ template "repo/settings/fragments/labelListing" (list $ .) }}
          {{ if $.RepoInfo.Roles.IsOwner }}
            <button
              class="btn text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 gap-2 group"
              title="Delete label"
              hx-delete="/{{ $.RepoInfo.FullName }}/settings/label"
              hx-swap="none"
              hx-vals='{"label-id": "{{ .Id }}"}'
              hx-confirm="Are you sure you want to delete the label `{{ .Name }}`?"
            >
              {{ i "trash-2" "w-5 h-5" }}
              <span class="hidden md:inline">delete</span> 
              {{ i "loader-circle" "w-4 h-4 animate-spin hidden group-[.htmx-request]:inline" }}
            </button>
          {{ end }}
        </div>
      {{ else }}
      <div class="flex items-center justify-center p-2 text-gray-500">
        no labels added yet
      </div>
      {{ end }}
    </div>
    <div id="label-operation" class="error"></div>
  </div>
{{ end }}

{{ define "deleteRepo" }}
  {{ if .RepoInfo.Roles.RepoDeleteAllowed }}
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-center">
    <div class="col-span-1 md:col-span-2">
      <h2 class="text-sm pb-2 uppercase text-red-500 dark:text-red-400 font-bold">Delete Repository</h2>
      <p class="text-red-500 dark:text-red-400 ">
        Deleting a repository is irreversible and permanent. Be certain before deleting a repository.
      </p>
    </div>
    <div class="col-span-1 md:col-span-1 md:justify-self-end">
      <button 
        class="btn group text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 flex gap-2 items-center"  
        type="button"
        hx-swap="none"
        hx-delete="/{{ $.RepoInfo.FullName }}/settings/delete"
        hx-confirm="Are you sure you want to delete {{ $.RepoInfo.FullName }}?">
          {{ i "trash-2" "size-4" }}
          delete
          <span class="ml-2 w-4 h-4 animate-spin hidden group-[.htmx-request]:inline">
            {{ i "loader-circle" "w-4 h-4" }}
          </span>
      </button>
    </div>
  </div>
  {{ end }}
{{ end }}

