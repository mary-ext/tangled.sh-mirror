{{ define "title" }}{{ .Issue.Title }} &middot; issue #{{ .Issue.IssueId }} &middot; {{ .RepoInfo.FullName }}{{ end }}


{{ define "extrameta" }}
    {{ $title := printf "%s &middot; issue #%d &middot; %s" .Issue.Title .Issue.IssueId .RepoInfo.FullName }}
    {{ $url := printf "https://tangled.sh/%s/issues/%d" .RepoInfo.FullName .Issue.IssueId }}

    {{ template "repo/fragments/og" (dict "RepoInfo" .RepoInfo "Title" $title "Url" $url) }}
{{ end }}

{{ define "repoContent" }}
    <header class="pb-2">
      <h1 class="text-2xl">
      {{ .Issue.Title | description }}
      <span class="text-gray-500 dark:text-gray-400">#{{ .Issue.IssueId }}</span>
      </h1>
    </header>

    {{ $bgColor := "bg-gray-800 dark:bg-gray-700" }}
    {{ $icon := "ban" }}
    {{ if eq .State "open" }}
        {{ $bgColor = "bg-green-600 dark:bg-green-700" }}
        {{ $icon = "circle-dot" }}
    {{ end }}

    <section class="mt-2">
        <div class="inline-flex items-center gap-2">
            <div id="state"
                class="inline-flex items-center rounded px-3 py-1 {{ $bgColor }}">
                {{ i $icon "w-4 h-4 mr-1.5 text-white" }}
                <span class="text-white">{{ .State }}</span>
            </div>
            <span class="text-gray-500 dark:text-gray-400 text-sm flex flex-wrap items-center gap-1">
                opened by
                {{ template "user/fragments/picHandleLink" .Issue.Did }}
               <span class="select-none before:content-['\00B7']"></span>
                {{ template "repo/fragments/time" .Issue.Created }}
            </span>
        </div>

        {{ if .Issue.Body }}
            <article id="body" class="mt-4 prose dark:prose-invert">
                {{ .Issue.Body | markdown }}
            </article>
        {{ end }}

        <div class="flex items-center gap-2 mt-2">
            {{ template "repo/fragments/reactionsPopUp" .OrderedReactionKinds }}
            {{ range $kind := .OrderedReactionKinds }}
                {{
                    template "repo/fragments/reaction"
                    (dict
                        "Kind"      $kind
                        "Count"     (index $.Reactions $kind)
                        "IsReacted" (index $.UserReacted $kind)
                        "ThreadAt"  $.Issue.AtUri)
                }}
            {{ end }}
        </div>
    </section>
{{ end }}

{{ define "repoAfter" }}
  <div class="flex flex-col gap-4 mt-4">
  {{
    template "repo/issues/fragments/commentList"
    (dict
      "RepoInfo" $.RepoInfo
      "LoggedInUser" $.LoggedInUser
      "Issue" $.Issue
      "CommentList" $.Issue.CommentList)
  }}

  {{ template "repo/issues/fragments/newComment" . }}
  <div>
{{ end }}

